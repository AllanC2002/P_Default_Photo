# Default Photo MicroService

This project is a Python-based backend service that assigns a default photo to a user. It uses Flask for the web framework and MongoDB as the database.

## Folder Structure

-   **`.github/workflows`**: This directory contains GitHub Actions workflow files.
    -   `docker-publish.yml`: Defines the CI/CD pipeline for automatically testing the application, building a Docker image, and deploying it to an EC2 instance.
-   **`conections`**: This folder is responsible for managing database connections.
    -   `mongo.py`: Contains the logic to connect to the MongoDB database using environment variables for credentials and host information.
-   **`services`**: This directory holds the core business logic of the application.
    -   `functions.py`: Includes functions like `assign_default_photo`, which handles the process of assigning a pre-defined default image to a specified user in the database.
-   **`tests`**: This folder contains automated tests for the application.
    -   `route_test.py`: A script to test the `/default-photo` endpoint.
    -   `test_default_photo.py`: Pytest unit tests, likely for the service functions.
-   **`__pycache__`**: These directories contain Python bytecode cache files, automatically generated by the Python interpreter. They are usually ignored by version control.

## Backend Design Pattern

The project follows a **Service-Oriented Architecture (SOA)** pattern, albeit in a simplified, monolithic form.

-   **API Layer/Controller (`main.py`)**: The `main.py` file, using Flask, defines the API endpoints. It receives HTTP requests, validates input, and calls the appropriate service functions.
-   **Service Layer (`services/functions.py`)**: This layer encapsulates the core business logic. For example, `assign_default_photo` orchestrates the interaction with the database to update user photo information.
-   **Data Access Layer (`conections/mongo.py`)**: This layer is responsible for all database interactions, abstracting the database operations from the service layer.

## Communication Architecture

-   **RESTful API**: The application exposes a RESTful API endpoint.
-   **HTTP/JSON**: Communication with the API is done via HTTP, with request and response bodies formatted in JSON.
-   **Monolithic Service**: Currently, the application is a single, monolithic service. All components (API, services, data access) are part of the same deployable unit.

## Folder Pattern

The project utilizes a **feature-based** or **functional** folder pattern. Code is organized into directories based on its primary function or responsibility within the application (e.g., `conections` for database connectivity, `services` for business logic).

## Endpoint Instructions

### Assign Default Photo

-   **Endpoint**: `/default-photo`
-   **Method**: `POST`
-   **Description**: Assigns a predefined default photo to the specified user. If the user already has a photo record, it updates it; otherwise, it creates a new record.

-   **Request Body**:
    ```json
    {
        "Id_User": "<USER_ID>"
    }
    ```
    -   `Id_User` (integer/string): The unique identifier for the user. This field is **required**.

-   **Success Response**:
    -   **Status Code**: `200 OK`
    -   **Body**:
        ```json
        {
            "message": "Default photo assigned to user <USER_ID>"
        }
        ```

-   **Error Responses**:
    -   **Status Code**: `400 Bad Request`
        -   **Body** (if `Id_User` is missing):
            ```json
            {
                "error": "Id_User is required"
            }
            ```
    -   **Status Code**: `404 Not Found`
        -   **Body** (if the default image is not found in the database):
            ```json
            {
                "error": "Default image not found"
            }
            ```

